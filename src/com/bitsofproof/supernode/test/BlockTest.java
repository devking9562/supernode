/*
 * Copyright 2012 Tamas Blummer tamas@bitsofproof.com
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.bitsofproof.supernode.test;

import java.io.IOException;

import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;

import org.junit.BeforeClass;
import org.junit.Test;
import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;
import org.springframework.orm.jpa.EntityManagerFactoryUtils;
import org.springframework.transaction.PlatformTransactionManager;
import org.springframework.transaction.TransactionStatus;
import org.springframework.transaction.support.TransactionCallbackWithoutResult;
import org.springframework.transaction.support.TransactionTemplate;

import com.bitsofproof.supernode.main.Setup;
import com.bitsofproof.supernode.model.Blk;
import com.bitsofproof.supernode.model.QBlk;
import com.mysema.query.jpa.impl.JPAQuery;

public class BlockTest
{
	private static PlatformTransactionManager transactionManager;
	private static ApplicationContext context;
	private static EntityManagerFactory emf;

	private static final boolean usedb = false;

	@BeforeClass
	public static void setup ()
	{
		try
		{
			if ( usedb )
			{
				Setup.setup ();
				context = new ClassPathXmlApplicationContext ("app-context.xml");
				transactionManager = context.getBean (PlatformTransactionManager.class);
				emf = context.getBean (EntityManagerFactory.class);
			}
		}
		catch ( IOException e )
		{
			e.printStackTrace ();
		}
	}

	@Test
	public void b1test ()
	{
		Blk b =
				Blk.fromWireDump ("0100000010557e969ab77a10d887e16889d026557af1f0b26cedf7c88c0c00000000000000f67fae6b5a36d94a2c28c44f9cb6dcbad70d621f2319dd4e7b4dd5c9da1821acfb1e4f3fd40c1abab9c7a21001000000010000000000000000000000000000000000000000000000000000000000000000ffffffff4807456c696769757302f8242cfabe6d6de8f5869ab721025db100f273cefd276491d5a1d827cc1f5fc2aa8ae0b42e9cfb08000000000000000f4e4f5032534800703273682f434856ffffffff3d01000000000000004341042514b141d63b1ecbb9a804d00c77fa477cb2387f606db22798acc8bfe4975d5911b0ecd7443770eef6f470dd3dadd632fbd35bf2fda1d06cfb5897c2440571eeacfab06005000000001976a9142838ae835c52722010adf4452eb5d7d1e6d9040088ac5ff6df04000000001976a91441dba8360f9a007bcb1bb44e1492b54bcf08dcf588ac41715904000000001976a9149ce9bf27b15d0045795c3275b7325482fb4f59e288ac28fc5f04000000001976a91412dfd33ce868b93b9a2c1a3d79b9951fc2ce431588acfd2c440a000000001976a9149240668e23f89d1488e5cfd7e9608a6d71177e5f88acd4397f04000000001976a914c73876a5e5978d29d6dff69e61633ef14ffba2e588acf02cfa04000000001976a91439eb449e3cdf858e054533de91c543fff76d2ae088ac52776504000000001976a914f89644e8a778cd74c77d79060c3d2eecba75ddb588ac96fe8a05000000001976a914b8c835af5f431a5b29f02f27f34617fab43f869d88acb319b404000000001976a9148f73f5c8bd9956e223866b4e8cfc6e7a17cadbb788acbff3d605000000001976a914be00333c4915f72ea0b2fc6a167e980cfe660af288acd6949b04000000001976a914df70a60b3383c4e471823e8d4c50dcc7a1e3e40988ac7c52ed05000000001976a914ad708c092091e9541e62f84212e16a425998538b88ac81013404000000001976a914175921ee734bff7ac37880ac5a3b90b77401e1dd88acb4ba4104000000001976a914d9700af0f5a2a717fa73d0e2a79f6991a240101988ac6ce72704000000001976a9147477c22cfe4607f7783bd3b1aae07a6d54bea5c388ac3e034e04000000001976a914d6309a28ad26747380adee68c78a82afc2e380b088ac2ebe7504000000001976a914418e4d605cce8e34289830a21614d66145b4a1da88ac29a49504000000001976a914ba133d57275c45340df72defa1e829723dd9798788ac28b87904000000001976a914b8ce3757dc532f40ed2d40fc92d008f0f0a8a27588ac541e5205000000001976a914ce725887fa245bb204539b6b588ba3525f40ae4b88ac1bea0604000000001976a914260a878df095dd1d3c7107494e9e7d577814a88888acc013d505000000001976a9141ba5c1c3c0916014ee18f35b2c8972d974e0c2c688ac1f674505000000001976a914cb3ecc087f55de91945a4136e8e0a7903dc5475688ac51542404000000001976a914cf4870debb2bb91753a48d6474bb3568e779d90188acb5827204000000001976a9142a8c470a2382d80fb56cdf60782590ff4787becd88ac8398ae04000000001976a9148ff3d75f2ac898a5a2192a51279d742864e4957088ac88db5c07000000001976a914f54d374d9d3fd0082889c8db062c80e482572b4888ac0f88d804000000001976a9146692cce99ba078578ca8b50e5f8291212ba2998988ac9a091d04000000001976a9146842185fa08274445666d62296b02bc05c5c02ee88ac767a8604000000001976a9145c968ac7791dcd6950a043b4d366f94363a4cc1a88ac49af1b04000000001976a9143b734e92f1b1d858b7b279d923fb8734cc73591f88ac12512c05000000001976a9141b498a462cafb9ffd0e420634f35c47cf509b87c88ac04bb0805000000001976a914107f37ee6c33342d59d72c295f1cc8eb2ee76a5588ac704d0204000000001976a914a9b53b47c3dd2951781daf6caea22c28a9ebdab288acdd111604000000001976a914b830ad1dc3489d356c1e06966ab6e794791b59e888ac35716b0e000000001976a914f39580c298ea1673d629aa9b569e17332959d3d788ac81f7c504000000001976a91411ac6255b7d51df0d707df0546e6274ebc1e55d288ac86863e04000000001976a9145fdccc745098071756679e4f10bad26ae99a344488acb40f8604000000001976a914323b8a16edcdfe3dcee2e34cddd672182d1ec04788ac235ad304000000001976a9144c173d8e1d0cabc424e0a26242999bd10e594f9f88ac275db704000000001976a914cd5813b9e4b38eae5c99eeabd76d09d346bd9c2688acdf160104000000001976a914205601e5f5ca09ee12f09e7e6f9ea843f65dc52388ac7a9e8704000000001976a91427f4762929a384c51b16acb06e7d40e4f9199d8c88ac8e881704000000001976a914f25510a7205aaab1f8f753046930e9567820abba88acf2494405000000001976a914012eebc0d3353bbd8b7982fded3d9790f2f42bd688acedc54f05000000001976a9142f2f21afdf4d621983d6ec1a2e605c46141ccc5488ac709c2904000000001976a914c3dd52845bfba22107c21501138a0c8b04a0347588ac6f6e0804000000001976a9140a70c198acf9f135d051e3a3548156f87a28c87e88acc62d1006000000001976a9144a08231d1e98824190575cd78f437318b05539f988ac2664f604000000001976a9144c3b3a8565717830a091c22af7d6b18af7219acf88ac3a759404000000001976a914bdc8359f2f3ae6444354c8020536bac4538e882088acdc480404000000001976a9146040e7d667f9c4e067f049ae490592ef5cd890db88acfb3bc504000000001976a9145acc17baa7814a453b8de815585958085ceeea5f88ac54d80a04000000001976a914d4ecf09f6b773b6a57076afcab41ffe545c0d0cd88acdcf50404000000001976a9142e451f91e9f756bb77a8a4c19b89106a72d56e2888ac03d6bd04000000001976a914cac51e198e50f78b352b7543450d4adb19a1ecb588ac9963f604000000001976a914e04293dbe8a159c932d9fa3422193bd4a55501ba88ac2e037b05000000001976a914ffd6e9827d705bc36b4746e4d4cc6365ca60d3af88aca2d95804000000001976a914c672e4144d0cdd6af3e4aedd71dca9a6dab7e8a688ac000000000100000001512b3d81f6aae5c755c2f2b95da770dba2a2733c5dc8efd9e9bf87cadbb00efd000000008b4830450220686301c88e37f558bbbbaa0c3cb0a5b6e803237cace646cf532cd9ad24a33aa00221008d57326a11ac100e0b875673e9ed502a864975a3d9b0a0d6e6ae7e36b6b412400141046489096b875f1226a7c43d9534a5cefb0095bb5e7aa8b11a8c5c8a66bd0bf3673fc199309a8b06b8b839be917dfe7bc6a5cc963373e9327f35be31e062c36e17ffffffff02f0fa4862000000001976a91489be0f14297cd9d87a883d197c42481c8f4f849888ac50c30000000000001976a9149871639659570507c1a7dda8b7e63bd68ac6c3ff88ac000000000100000001af7481c0a7ef7202055ded208f3c4646de1c5db6f6da6eacb8885b90caf9daa3000000008b483045022037e20cc39e04bc6f9fe02bfd2ac44e7864b59ebaad4bcd7b4e7012dedaf30250022100ddd390ec835b9478d3d667a5028b3cf30a2b6fb5f099721e6e4bcc687a57bc2c014104127504ba1a3f162f92b1b1d3d848804c071e8a5615ed6e213b328c55bb136e7636f0781360f603eddfda637d706c338dc86dfe9cde938791c0450491a838ace4ffffffff022d03f605000000001976a9144e598105d9273f01e4b37f42060b0206ee1a338288ac581b0000000000001976a91404e116f6f1236ed1d0e40f03a20de85e81d6c6df88ac000000000100000001052bcc80fbda96d558774d3b0b8c54b9f0f2e74ec80aa223603338b25381cb24010000008a47304402201d2ceff84c9785f975673ded2e27352e4635b869f9324f2392175a0ce438f79e02201e36ac6a99d587b2e23895127fafa8b91c9c61ef8950682cf0da99837e5fd10c014104cf718db6ce93248db0fce61bc386d81d528d518397319cd65501e859e8c6938385318d660634b9435ddfd706743153b645ae84820d67a79b4645f1c682742fe7ffffffff0230cfc107000000001976a914dd207cbea457661622232cf4a8f068a7b04da95088acda020000000000001976a9142bd16fdc4a06a1ebdb87a27ad832590fc24e145488ac000000000100000001e0069c3c29aa0380df6e5d81e9f0a8b88ff830b11c0505dd23fcf11fee27598b010000008a47304402202076619f9798728541969d5c654b7d28e80b795aecc80d1ef99af8270f4f238f0220072eb7a19b2268086ddf51f2b36876aa905d46f5fc845ebf9aee46f1707a4e2e0141042c27a401505b3200389ab8c7dffc263688309db64a3566aaad7bb841a65afd53888e7a25ddc7449e20e94d18de72d5df91d594c0c078bd46adc88763492183f2ffffffff0270c5120d000000001976a914c7f1a164c9e7acd274cfff57936e65fb504233c988ac90290a00000000001976a91404e116f6f1236ed1d0e40f03a20de85e81d6c6df88ac000000000100000001276487a39036cba882b2caacf71871b71c04d252531dd27cd41eacbc3c8ef9fa000000008c493046022100d8a5337a589bd09476766802a13dafc316233f89d12f9356717b8d89ac88578d022100aaeea896faf653016efe663b025849b1849fd00c2e79304029650450033cc4f40141042e5508c3d14b24875cec2371cafd2af48ca768418b980c00d24e42d062c1a10179cfc8803a0a3578e23c332024aaf1bf887d04de3700d0538152a9d1411498ccffffffff022ece644f0a0000001976a914e45ef6cf73e5bfc071683067a8b54b6b8e09699688ac20ad6a04000000001976a9141b8d0b6fcb555d6b1d6691105324421504efffa688ac000000000100000001eaf315bfc0b7640d9f5b6eed7e841f83ef31267516a44f61a5d39a56b09b3df6010000008b483045022100e1b6a8f2dfba67700531751642c2435a35461c09c1bf26c0953af244c3babfb0022055d71c1e3260c782460af4fc83d78a9b27666be1064540da727740cf139cc9d5014104053ddc2719d965d1642344e422747cdfbf2940d0b2b259aa64c9c09170dcb6e0c4fb20ab7a89fe8364a7c108dcbbee341fab87bea645c5e8319152dce5eda608ffffffff02b8438b0a000000001976a914f23d4d39c4f2f00153772cd401c3e7fe2c73b23788ace8030000000000001976a914cb32604486824f294243f434e8546c98c26bfa8888ac0000000001000000011113675cb2a81a3ba51f78aee910e1578736848dfe78c522383bc49ee09215b8010000008b48304502201f297dfdcd8de043354bffdab5a9d3a636053c131c3f4af35ddffba73d60d227022100d1025723b7df1767f2e64dc191befb3db4430ca1b03b8d0b75cc52421a2267d001410468a5ba419bf775eec1518f9c4eebdbb159099c74a61b00292c7a0038a4a125b35e8e757d515a98641c6d2ccfb6da94debe45d82fa3255c48f98bf681aba89617ffffffff0290290a00000000001976a91416c702575103586fbcc5269f78bc329b812f053688acb03cf900000000001976a91456803d69e39dfd8264579dfeb1feab7b222f9de988ac000000000100000001b62568c344fa06f53370ac5fee35d0a3e8bad53180e92fe07d06df750bee64c7000000008c493046022100b4a2bbac39960074d0e6137cead0318940a7fcb79a87a767fb9d0bebd82359d4022100899e6332f9e2d8207911359a1c8febe57ae91fe6ea7c987d93c118adafd4ece9014104d539aaf95044fc39686cc0fb861d1517fb545160dd1208d14147845fa84cd726e22b00f6ab6ee6d323ea3b9c7ab5a0f48a3b8030291e0584be8ca79d3846f5baffffffff0200350c00000000001976a914ef12b94396de82af2b29e8ef4c2e3a180ea5059d88ac332de800000000001976a9146624f06a0e2f77e21032f03a7b65c809d3fac06788ac00000000010000000473c08fccbb4be727e3705c3cbfb6ca0d5ffcece2dfd3ecc585794bf49d5e24cd010000008b483045022012f400de6d1bd1e419c9359b9c4f1655c90b0733655590a86831f39aadf71bf5022100bee09e63962779f77ee9cecdffc07c5877ce006b9b71d67ad528ffa319a54bbf014104ba7218c27fa3ce013a33895a3511853f4765115bfc9a104ea83578df42ef14938b828775c55ca467b279b8ba3208d3b772ede39496a321e338b4c3dc5498fb87ffffffff5cc160e49c298b0491c9f3b189354bb7897751f55a0a0bf8ed034132b6ae27cc010000008b48304502207fa17a8131e287ad2b670b1ccc19baff5aef195075b2593442592ed005a9e2e9022100e2003d9bc349de0b0b46f5f662fb5184f78dcbde0f8091ad78b1e9e0f0ac5bea014104ba7218c27fa3ce013a33895a3511853f4765115bfc9a104ea83578df42ef14938b828775c55ca467b279b8ba3208d3b772ede39496a321e338b4c3dc5498fb87ffffffffeab76d6427f62a43927c1ab70a996039055c1c22ceefefa35b561a7ecd1f4914010000008b4830450220265200e6503220f03580c58b37b7eee0b9f6ade73481d2670f9c0264c5f98286022100ea29047189aebca045f15a6659f2f763f3e21da6df2e6fbfdc0b0084bee245630141048c25ca93acbea114e093d19bf1ae7f55a03808d27c8f99265b3293d43dcb1fb3d2a3a42cb2d2e49e5b0057004870b35923ce6f697a656ca5a94cc63d7acb96e5ffffffff2f96533e086c869d1ff626686b19b927a65db080fde6d1b45f72d2bfb54000bb000000008b483045022061845669092e5647781e703f68b0629d23402b537e7ee9ca7d67bfad5ddea3e10221009e9b5d63ace5935989170f6305f15f602ddb45d5b609291b2bb8385613ab8e52014104296c15d4590d7c568e095cfdebabf0b0e122f93a3b1ced67d558bd1132d81278d3430af5e86c4b41b0221b0374558d08724777bfadc3c9d84ed661496abd40cfffffffff020474a901000000001976a914a4b5e56a72c5d47e08887cc0f221d4c8fb1c97d888ac8033023b000000001976a9145bb3361bb5d33d9e556bbfa5da5445997b7b9d6688ac000000000100000001070f3435ff948a03b3c2cffccfc18c62bb23fac0a88518dbafc66ca9e3463c2e010000008b4830450220747b43a6c6b6043eaac3d1ef5e4688141d7eecc83ea8935c73ae17583a14cd45022100978332354627dd3678dfdc22887f7e1e25e176913e98e14848d5933e0285a80201410496b15cadb73264cec1fb835d828b0d43822291e1388992c2a6a01a32cf96e2363ff0d989cee9573cd8e8ea11341a32b926945445bcabde6fc68e29dda4f67a87ffffffff02325c4301000000001976a91430af6f028e8997e19d42eac7e1680d61a0220f9f88ace8030000000000001976a914d4474dfb6e8c9f93601b0dc4e499bfe14beb22a888ac0000000001000000017ea56cd68c74b4cd1a2f478f361b8a67c15a6629d73d95ef21d96ae213eb5b2d010000006a4730440220228e4deb3bc5b47fc526e2a7f5e9434a52616f8353b55dbc820ccb69d5fbded502206a2874f7f84b20015614694fe25c4d76f10e31571f03c240e3e4bbf1f9985be201210232abdc893e7f0631364d7fd01cb33d24da45329a00357b3a7886211ab414d55affffffff0230c11d00000000001976a914709dcb44da534c550dacf4296f75cba1ba3b317788acc0c62d000000000017142a9bc5447d664c1d0141392a842d23dba45c4f13b175000000000100000003b651817695ea01153e71a6db0569ff2b091a74f24367532be3315e3e7bb11ee6010000008c493046022100c2d2cfa17ecf2178ebdc0e840c27f04c6fe5c9b103a33c0341e8b0fc4e3b69dd022100cecbfae440eebf73b1bb6ada30608b4a8687cb3b52aaaa8ba3f5f0fe2bb38b8201410406e9d9eb7a0dba4f82bb83dded50d3a2f53904c74088389b8876172b0355cd71096bd294e4bb6a600aeab82aad47ef4eed84230265d6a62e2fd6a9d48470547effffffffb9f28227e268f9e49afeedc0e510cec30b79930c3f64eb1e157e5af339008a3c010000008b483045022100f6162d076f0b88ab4f6e9824065c9b93577887bd1f00905a57a826d2e6b0714f0220267da8d050080b4ea77f1dfe4afb72122728d02b8a49d3753bac4ac68b983d4501410406e9d9eb7a0dba4f82bb83dded50d3a2f53904c74088389b8876172b0355cd71096bd294e4bb6a600aeab82aad47ef4eed84230265d6a62e2fd6a9d48470547effffffffb6572b48d6b9227995fe803191571b08c57115da47e287f18c55766ed53f683a010000008a473044022041c195a808744dca15ee5be72e4096722598dd77b3bb60af2f8e0ea9f8ee76af022017475124419b5ad5d6dfb3f82506e5f2d7a1182b863aa4ec077a012c078c0c7501410406e9d9eb7a0dba4f82bb83dded50d3a2f53904c74088389b8876172b0355cd71096bd294e4bb6a600aeab82aad47ef4eed84230265d6a62e2fd6a9d48470547effffffff01fb2d0000000000001976a91431bd55deac5fecef6faf9d2f3db27a1b998afba388ac0000000001000000024de8b0c4c2582db95fa6b3567a989b664484c7ad6672c85a3da413773e63fdb8000000006b48304502205b282fbc9b064f3bc823a23edcc0048cbb174754e7aa742e3c9f483ebe02911c022100e4b0b3a117d36cab5a67404dddbf43db7bea3c1530e0fe128ebc15621bd69a3b0121035aa98d5f77cd9a2d88710e6fc66212aff820026f0dad8f32d1f7ce87457dde50ffffffff4de8b0c4c2582db95fa6b3567a989b664484c7ad6672c85a3da413773e63fdb8010000006f004730440220276d6dad3defa37b5f81add3992d510d2f44a317fd85e04f93a1e2daea64660202200f862a0da684249322ceb8ed842fb8c859c0cb94c81e1c5308b4868157a428ee01ab51210232abdc893e7f0631364d7fd01cb33d24da45329a00357b3a7886211ab414d55a51aeffffffff02e0fd1c00000000001976a914380cb3c594de4e7e9b8e18db182987bebb5a4f7088acc0c62d000000000017142a9bc5447d664c1d0141392a842d23dba45c4f13b175000000000100000002cbbc32acfd347fcc5b2466974c12be20eb15495be50b8b6dfa3e4e88c0823beb000000006a47304402205e9e74f93f6aa1b095bbe124be0be95aeca52ebe91f214c86febe512b26c827c0220379ee83416df7c2adc753b5eefe61e7aef10ec208b549a249b6006e8009a0e210121031dd6da443782f1099b0ed98060b9ee1b81cd2392e938d23015749625c7dd0470ffffffffcbbc32acfd347fcc5b2466974c12be20eb15495be50b8b6dfa3e4e88c0823beb010000007000483045022013187aed1aeaaca0ca8a7c0e4f6362070208e68a5230c7a3cf65d922da19964802210082ac0719fd2be6c40b550791a96449e6bf1f70ed9492f88e825416c099d36b2601ab51210232abdc893e7f0631364d7fd01cb33d24da45329a00357b3a7886211ab414d55a51aeffffffff02903a1c00000000001976a914f7d46c08dd53bc6bbb52178d60b3fc99a9c1fb8788acc0c62d000000000017142a9bc5447d664c1d0141392a842d23dba45c4f13b17500000000010000000237b17d763851cd1ab04a424463d413c4ee5cf61304c7fd76977bea7fce075705000000006a473044022002dbe4b5a2fbb521e4dc5fbec75fd960651a2754b03d0871b8c965469be50fa702206d97421fb7ea9359b63e48c2108223284b9a71560bd8182469b9039228d7b3d701210295bf727111acdeab8778284f02b768d1e21acbcbae42090cc49aaa3cc6d19cdaffffffff37b17d763851cd1ab04a424463d413c4ee5cf61304c7fd76977bea7fce0757050100000070004830450220106a3e4ef0b51b764a28872262ffef55846514dacbdcbbdd652c849d395b4384022100e03ae554c3cbb40600d31dd46fc33f25e47bf8525b1fe07282e3b6ecb5f3bb2801ab51210232abdc893e7f0631364d7fd01cb33d24da45329a00357b3a7886211ab414d55a51aeffffffff01003e4900000000001976a9140d7713649f9a0678f4e880b40f86b93289d1bb2788ac00000000");
		System.out.println (b.toJSON ());
	}

	@Test
	public void rewardTest ()
	{
		if ( !usedb )
		{
			return;
		}
		new TransactionTemplate (transactionManager).execute (new TransactionCallbackWithoutResult ()
		{

			@Override
			protected void doInTransactionWithoutResult (TransactionStatus status)
			{
				EntityManager entityManager = EntityManagerFactoryUtils.getTransactionalEntityManager (emf);
				QBlk blk = QBlk.blk;

				JPAQuery query = new JPAQuery (entityManager);

				Blk b = query.from (blk).where (blk.hash.eq ("0000000000004c78956f8643262f3622acf22486b120421f893c0553702ba7b5")).uniqueResult (blk);
				System.out.println (b.toJSON ());
			}
		});
	}

}
